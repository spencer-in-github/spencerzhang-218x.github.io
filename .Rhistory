name = "acs/acs1",
vintage = 2019,
region = "county:001,013,041,055,075,081,085,095,097",
regionin = "state:06", #BAY AREA DATA
vars = "group(B15002)" #latinx
) %>%
select(ends_with("E")&-state) %>%
separate(
col = "NAME",
sep = " County",
into = c("county",NA)
) %>%
pivot_longer(!county,
names_to = "name",
values_to = "estimate") %>%
left_join(
acs_vars_2019_1yr %>%
select(name,label),
by = c("name")
) %>%
select(-name) %>%
separate(
col = "label",
sep = "!!",
into = c(NA,NA,NA, "education")
) %>%
filter(!is.na(education)) %>%
mutate(
education = ifelse(
education %in% level_edu[1:9], "no college", "college"
)
) %>%
group_by(county,education) %>%
summarise(estimate = sum(estimate)) %>%
group_by(county) %>%
.summarise(
estimate, education,
total = sum(estimate),
perc = estimate/total
) %>%
filter(education == "no college") %>%
select(county,perc)
bay_edu_total <-
getCensus(
name = "acs/acs1",
vintage = 2019,
region = "county:001,013,041,055,075,081,085,095,097",
regionin = "state:06", #BAY AREA DATA
vars = "group(B15002)" #latinx
) %>%
select(ends_with("E")&-state) %>%
separate(
col = "NAME",
sep = " County",
into = c("county",NA)
) %>%
pivot_longer(!county,
names_to = "name",
values_to = "estimate") %>%
left_join(
acs_vars_2019_1yr %>%
select(name,label),
by = c("name")
) %>%
select(-name) %>%
separate(
col = "label",
sep = "!!",
into = c(NA,NA,NA, "education")
) %>%
filter(!is.na(education)) %>%
mutate(
education = ifelse(
education %in% level_edu[1:9], "no college", "college"
)
) %>%
group_by(county,education) %>%
summarise(estimate = sum(estimate)) %>%
group_by(county) %>%
summarise(
estimate, education,
total = sum(estimate),
perc = estimate/total
) %>%
filter(education == "no college") %>%
select(county,perc)
bay_edu_total <-
yr %>%
map_dfr(function(x){
getCensus(
name = "acs/acs1",
vintage = x,
region = "county:001,013,041,055,075,081,085,095,097",
regionin = "state:06", #BAY AREA DATA
vars = "group(B15002)" #latinx
) %>%
select(ends_with("E")&-state) %>%
separate(
col = "NAME",
sep = " County",
into = c("county",NA)
) %>%
pivot_longer(!county,
names_to = "name",
values_to = "estimate") %>%
left_join(
acs_vars_2019_1yr %>%
select(name,label),
by = c("name")
) %>%
select(-name) %>%
separate(
col = "label",
sep = "!!",
into = c(NA,NA,NA, "education")
) %>%
filter(!is.na(education)) %>%
mutate(
education = ifelse(
education %in% level_edu[1:9], "no college", "college"
)
) %>%
group_by(county,education) %>%
summarise(estimate = sum(estimate)) %>%
group_by(county) %>%
summarise(
estimate, education,
total = sum(estimate),
perc = estimate/total
) %>%
filter(education == "no college") %>%
select(county,perc) %>%
mutate(year = x)
})
bay_latinx_over <-
left_join(bay_latinx,bay_edu_total,by = c("county","year"))
View(bay_latinx_over)
bay_latinx_over <-
left_join(bay_latinx,bay_edu_total,by = c("county","year")) %>%
mutate(
over = perc.x/perc.y
)
bay_latinx_over <-
left_join(bay_latinx,bay_edu_total,by = c("county","year")) %>%
mutate(
over = perc.x/perc.y
) %>%
select(-c(perc.x, perc.y))
bay_latinx_over %>%
group_by(county) %>%
ggplot() +
geom_line(
aes(
x = year,
y = estimate,
fill = county
)
)
bay_latinx_over %>%
group_by(county) %>%
ggplot() +
geom_line(
aes(
x = year,
y = estimate,
group = county
)
)
bay_latinx_over %>%
group_by(county) %>%
ggplot() +
geom_line(
aes(
x = year,
y = over,
group = county
)
)
bay_latinx_over %>%
group_by(county) %>%
ggplot() +
geom_line(
aes(
x = year,
y = over,
group = countyï¼Œ
fill = county
)
)
bay_latinx_over %>%
group_by(county) %>%
ggplot() +
geom_line(
aes(
x = year,
y = over,
group = county,
fill = county
)
)
bay_latinx_over %>%
group_by(county) %>%
ggplot() +
geom_line(
aes(
x = year,
y = over,
group = county,
color = county
)
)
bay_latinx_over %>%
group_by(county) %>%
ggplot() +
geom_line(
aes(
x = year,
y = over,
color = county
)
)
bay_latinx_over %>%
group_by(county) %>%
ggplot() +
geom_line(
aes(
x = year,
y = over,
color = county
)
) +
labs(
x = "Year",
y = "Y",
title = "Latin 25+ Population with no college degree <br>is [Y] times over-represented, relative to % Latinx in overall population"
) +
theme(
legend.position = "bottom",
legend.direction = "vertical"
)
bay_latinx_over %>%
group_by(county) %>%
ggplot() +
geom_line(
aes(
x = year,
y = over,
color = county
)
) +
labs(
x = "Year",
y = "Y",
title = "Latin 25+ Population with no college degree </br>is [Y] times over-represented, relative to % Latinx in overall population"
) +
theme(
legend.position = "bottom",
legend.direction = "vertical"
)
bay_latinx_over %>%
group_by(county) %>%
ggplot() +
geom_line(
aes(
x = year,
y = over,
color = county
)
) +
labs(
x = "Year",
y = "Y",
title = "Latin 25+ Population with no college degree </br/>is [Y] times over-represented, relative to % Latinx in overall population"
) +
theme(
legend.position = "bottom",
legend.direction = "vertical"
)
bay_latinx_over %>%
group_by(county) %>%
ggplot() +
geom_line(
aes(
x = year,
y = over,
color = county
)
) +
labs(
x = "Year",
y = "Y",
title = "Latin 25+ Population with no college degree <\br>is [Y] times over-represented, relative to % Latinx in overall population"
) +
theme(
legend.position = "bottom",
legend.direction = "vertical"
)
bay_latinx_over %>%
group_by(county) %>%
ggplot() +
geom_line(
aes(
x = year,
y = over,
color = county
)
) +
labs(
x = "Year",
y = "Y",
title = "Latin 25+ Population with no college degree <br> is [Y] times over-represented, relative to % Latinx in overall population"
) +
theme(
legend.position = "bottom",
legend.direction = "vertical"
)
bay_latinx_over %>%
group_by(county) %>%
ggplot() +
geom_line(
aes(
x = year,
y = over,
color = county
)
) +
labs(
x = "Year",
y = "Y",
title = "Latin 25+ Population with no college degree \nis [Y] times over-represented, relative to % Latinx in overall population"
) +
theme(
legend.position = "bottom",
legend.direction = "vertical"
)
#plot
bay_edu %>%
group_by(education, race) %>%
summarize(estimate = sum(estimate)) %>%
ggplot() +
geom_bar(
aes(
x = education %>% factor(levels = rev(unique(bay_edu$education))),
y = estimate,
fill = race %>% factor(levels = rev(unique(bay_edu$race)))
),
stat = "identity",
position = "fill"
) +
labs(
x = "Educational attainment",
y = "Population",
title = "Bay Area educational attainment by race",
fill = "Race"
) + coord_flip() +
theme(
legend.position = "bottom",
legend.direction = "vertical"
)  +
guides(
fill = guide_legend(
reverse = T
)
)
bay_edu_all <-
bay_edu %>%
group_by(education) %>%
summarise(estimate = sum(estimate)) %>%
mutate(race = "total") %>%
left_join(
., bay_edu_latinx %>%
group_by(education) %>%
summarise(estimate = sum(estimate)) %>%
mutate(race = "White and Latinx"),
by = "education"
) %>%
mutate(
estimate = estimate.x - estimate.y,
race = "Not White, not Latinx"
) %>%
select(education,estimate,race) %>%
rbind(., bay_edu_latinx)
bay_edu_all %>%
group_by(education, race) %>%
summarize(estimate = sum(estimate)) %>%
ggplot() +
geom_bar(
aes(
x = education %>% factor(levels = rev(unique(bay_edu_all$education))),
y = estimate,
fill = race %>% factor(levels = rev(unique(bay_edu_all$race)))
),
stat = "identity",
position = "fill"
) +
labs(
x = "Educational attainment",
y = "Population",
title = "Bay Area educational attainment by ethnicity",
fill = "Ethnicity"
) + coord_flip() +
theme(
legend.position = "bottom",
legend.direction = "vertical"
)  +
guides(
fill = guide_legend(
reverse = T
)
)
#latinx
latinx_race_categories <-
c(
"White, not Latinx",
"Latinx",
"Not white, not Latinx"
)
bay_edu_latinx <-
8:9 %>%  #loop
map_dfr(function(x){
getCensus(
name = "acs/acs5",
vintage = 2019,
region = "county:001,013,041,055,075,081,085,095,097",
regionin = "state:06",
vars = paste0("group(C15002",LETTERS[x],")")
) %>% #different var names for the seven races
select(ends_with("E")&-c(state, NAME)) %>%
summarise_all(sum) %>%
pivot_longer(everything(),
names_to = "name",
values_to = "estimate") %>%
left_join(
acs_vars_2019_5yr %>%
select(name,label),
by = c("name")
) %>%
separate(
col = "label",
sep = "!!",
into = c(NA,NA, NA, "education")
) %>%
filter(!is.na(education)) %>%
group_by(education) %>%
summarise(estimate = sum(estimate)) %>%
mutate(race = latinx_race_categories[x-7])
})
bay_edu_all <-
bay_edu %>%
group_by(education) %>%
summarise(estimate = sum(estimate)) %>%
mutate(race = "total") %>%
left_join(
., bay_edu_latinx %>%
group_by(education) %>%
summarise(estimate = sum(estimate)) %>%
mutate(race = "White and Latinx"),
by = "education"
) %>%
mutate(
estimate = estimate.x - estimate.y,
race = "Not White, not Latinx"
) %>%
select(education,estimate,race) %>%
rbind(., bay_edu_latinx)
bay_edu_all %>%
group_by(education, race) %>%
summarize(estimate = sum(estimate)) %>%
ggplot() +
geom_bar(
aes(
x = education %>% factor(levels = rev(unique(bay_edu_all$education))),
y = estimate,
fill = race %>% factor(levels = rev(unique(bay_edu_all$race)))
),
stat = "identity",
position = "fill"
) +
labs(
x = "Educational attainment",
y = "Population",
title = "Bay Area educational attainment by ethnicity",
fill = "Ethnicity"
) + coord_flip() +
theme(
legend.position = "bottom",
legend.direction = "vertical"
)  +
guides(
fill = guide_legend(
reverse = T
)
)
bay_latinx_over %>%
group_by(county) %>%
ggplot() +
geom_line(
aes(
x = year,
y = over,
color = county
)
) +
labs(
x = "Year",
y = "Y",
title = "Latin 25+ Population with no college degree \nis [Y] times over-represented, relative to % Latinx in overall population"
) +
theme(
legend.position = "bottom",
legend.direction = "vertical"
)
